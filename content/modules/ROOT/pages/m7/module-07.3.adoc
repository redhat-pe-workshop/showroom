:imagesdir: ../../assets/images

include::../style.adoc[]

== Observability

As a Red Hat Developer Hub administrator, you can track user activities, system events, and data changes with Developer Hub audit logs.
Administrators can view, search, filter, and manage the log data from the Red Hat OpenShift Container Platform web console

== Audit logging

=== Logging deployment


=== Logging collector

=== Log forwarding


== Monitoring and logging

In OpenShift Container Platform, metrics are exposed through an HTTP service endpoint under the /metrics canonical name. You can create a ServiceMonitor custom resource (CR) to scrape metrics from a service endpoint in a user-defined project.

=== Setup monitoring for user-defined projects 

As a first step, you will need to create the cluster-monitoring-config ConfigMap object:


. Visit the https://console-openshift-console.{openshift_cluster_ingress_domain}/topology/ns/backstage?view=graph[backstage project^, window="console"] in your OpenShift cluster. You can login as *admin/{common_password}*
. Click the (+) button on the top navbar on OpenShift to create this ConfigMap
image:m7/create-yaml.png[] 
. Copy the following ConfigMap and paste it into the YAML editor. In this configMap, when the `enableUserWorkload` parameter is set to true, it enables monitoring for user-defined projects in an OpenShift cluster.
+
[.console-input]
[source,shell script]
----
apiVersion: v1
kind: ConfigMap
metadata:
  name: cluster-monitoring-config
  namespace: openshift-monitoring
data:
  config.yaml: |
    enableUserWorkload: true
----
. Click the *Save* button.

=== Enable metrics monitoring on OpenShift

In this step we will enable the metrics monitoring on {product_name_rhdh}

. Open your https://gitlab-gitlab.{openshift_cluster_ingress_domain}/rhdh/developer-hub-config/-/blob/main/values.yaml[values.yaml file, window="gitlab"].
. Select *Edit > Edit single file*. When prompted, login as a Platform Engineer with `pe1/{common_password}`
. Find the YAML surrounded by `--- MONITORING ---` and uncomment it by highlighting it and pressing `CMD + /` or `CTRL + /`.
+
image:m7/uncomment-monitoring.png[width=60%] 
. Click Refresh on the https://openshift-gitops-server-openshift-gitops.{openshift_cluster_ingress_domain}/applications[`backstage` Application in OpenShift GitOps^, window="argo"]. If prompted, login as `admin/{openshift_gitops_password}`.
. Wait until the Application reports being in a *Healthy* state.
. You will also see a new `servicemonitor` has been created for {product_name_rhdh}. You can view this by navigating to the `backstage` ArgoCD app
+
image:m7/new-service-monitor.png[] 


=== Verification

You can view the {product_name_rhdh}'s metrics  from the Developer perspective of the OpenShift web console within the `backstage` namespace


. Visit the https://console-openshift-console.{openshift_cluster_ingress_domain}/dev-monitoring/ns/backstage[metrics^, window="console"] page to view this *Observe* menu on OpenShift
. Click the Metrics tab, and from the `Select query` drop down, choose `Custom query`
+
image:m7/select-custom-query.png[] 
. You can query a number of parameters by entering a query into the the `Expression` text area,
+
image::m7/expression-area.png[] 
.. Enter `catalog_entities_count` into the textarea and hit `Enter` to view metrics such as how many components, users, templates etc are present in the 
+
image:m7/catalog-entities-count.png[] 
.. `scaffolder_task_count` results in the count and user details
+
image:m7/scaffolder_task_count.png[] 
.. Other examples are `scaffolder_step_count`, `scaffolder_task_count` can yield interesting info about the template usage as well. The below screenshot shows output for `scaffolder_step_count`
+
image::m7/scaffolder-task-count.png[]  

. You can leverage the metrics to build custom Grafana dashboards to visualise them as well.